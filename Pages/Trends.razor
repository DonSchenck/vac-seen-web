@page "/trends"

@using System.Net.Http.Json
@using System.Text.Json;

<PageTitle>Vaccination Trends</PageTitle>

<h1>Trends</h1>

<Chart Config="_config1" @ref="_chart1"></Chart>

@code {
    private BarChartConfig _config1;
    private Chart _chart1;

    protected override async Task OnInitializedAsync()
    {
        _config1 = new BarChartConfig()
            {
                Options = new Options()
                {
                    Plugins = new Plugins()
                    {
                        Legend = new Legend()
                        {
                            Align = LegendAlign.Center,
                            Display = false,
                            Position = LegendPosition.Right
                        }
                    },
                    Scales = new Scales()
                    {
                        X = new XAxes()
                        {
                            Stacked = true,
                            Ticks = new Ticks()
                            {
                                MaxRotation = 0,
                                MinRotation = 0
                            }
                        },
                        Y = new YAxes()
                        {
                            Stacked = true
                        }
                    }
                }
            };


        //        public static List<string> SimpleBarText = new List<string>() { "January", "February", "March", "Aprl", "May", "June", "July" };
        string vaxJson = "[{\"date\":\"20220608\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220609\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220610\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220611\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220612\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220613\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220614\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220615\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220616\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220617\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220618\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220619\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220620\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220621\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220622\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220623\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220624\",\"countryCode\":\"US\",\"count\":0},{\"date\":\"20220625\",\"countryCode\":\"US\",\"count\":24},{\"date\":\"20220626\",\"countryCode\":\"US\",\"count\":23},{\"date\":\"20220627\",\"countryCode\":\"US\",\"count\":9},{\"date\":\"20220628\",\"countryCode\":\"US\",\"count\":22}]";

        var list = JsonSerializer.Deserialize<List<Vaccination>>(vaxJson);

        Console.WriteLine($"There are {list.Count} entries");

        _config1.Data.Labels = BarDataExamples.SimpleBarText;
        _config1.Data.Datasets.Add(new BarDataset()
            {
                Label = "Value",
                Data = BarDataExamples.SimpleBar.Select(l => l.Value).ToList(),
                BackgroundColor = Colors.Palette1,
                BorderColor = Colors.PaletteBorder1,
                BorderWidth = 1
            });
    }
}
